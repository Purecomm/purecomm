// GLOBAL JS // 

// Navigation, Desktop & Mobile //
languageOptions = ['en', 'zh-cn', 'zh-hk', 'jp-jp', 'ko-kr', 'th-th'];

languageDictionary = {
    'en': 'en',
    'en-gb': 'en',
    'en-us': 'en',
    'zh-cn': 'zh-cn',
    'zh-hk': 'zh-ch',
    'ko-kr': 'ko-kr',
    'th-th': 'th-th',
    'jp-jp': 'jp-jp',
} 

jQueryBridget('flickity', Flickity, $);

$('.main-gallery').flickity({
    cellAlign: 'left',
    contain: true,
    freeScroll: false,
    wrapAround: true,
    setGallerySize: false,
    pageDots: false,
    autoPlay: 8500
});

function checkLanguage() {
    let lang = localStorage.getItem('lang');
    let urlLang = window.location.pathname.split('/')[1];

    if(isNullOrWhitespace(urlLang)) {
        if (!lang) {
            lang = navigator.language.toLocaleLowerCase();
        }
        if (lang) {
            let userLang = languageDictionary[lang];
            changeLanguage(userLang);
        }
    }
    else {
        localStorage.setItem('lang', urlLang);
    }

    var windowWidth = $(window).width();

    if (windowWidth < 500 && lang === 'th-th') {
        $('.integrations-container').css('display', 'none');
    };
};

function isNullOrWhitespace( input ) {
    return !input || !input.trim();
}

checkLanguage();

// Changing language
function changeLanguage(lang) {
    if (languageOptions.indexOf(lang) === -1) {
        return;
    }
    localStorage.setItem('lang', lang);
    window.location.href = '/' + lang;
}

// Dropdown menu
var windowWidth = $(window).width();
if (windowWidth > 800) {
    $('.main-links').mouseenter(function (e) {
        $(".nav-dropdown").hide();
        $(this).next('.nav-dropdown').show();
        e.stopPropagation();
    });

    $('.nav-dropdown').mouseleave(function (e) {
        $('.nav-dropdown').hide();
        e.stopPropagation();
    });

    $('.nav-dropdown').click(function (e) {
        $('.nav-dropdown').hide();
        e.stopPropagation();
    });

    $('nav').mouseleave(function (e) {
        $('.nav-dropdown').hide();
    })
}

if (windowWidth < 800) {
    $('.main-links').click(function (e) {
        $(this).next('.nav-dropdown').slideToggle();
        e.preventDefault();
        e.stopPropagation();
    });
}

$('.nav-dropdown').click(function () {
    $('.nav-dropdown').hide();
});
$('html:not(.nav-dropdown)').click(function (e) {
    $('.nav-dropdown').hide();
    e.stopPropagation();
});

$('#nav-toggle').click(function () {
    $('nav ul').slideToggle();
});

$('#nav-toggle').on('click', function () {
    this.classList.toggle('active');
});
$('.nav-dropdown').click(function (e) {
    $('#nav-toggle').removeClass('active');
    $('.nav-list').hide();
    e.stopPropagation();
})
$('nav > ul > li > a:only-child').click(function (e) {
    $('#nav-toggle').removeClass('active');
    $('.nav-list').hide();
    e.stopPropagation();
});



// Smooth scroll to different page //
var jump=function(e) {
   if (e){
       e.preventDefault();
       var target = $(this).attr("href");
   } else{
       var target = location.hash;
   } $('html,body').stop().animate({
       scrollTop: $(target).offset().top
   },800,function(){
       location.hash = target;
   });
}

$('html, body').hide();
$(document).ready(function() {
    $("a[href^='#']").bind("click", jump);
    if (location.hash){
        setTimeout(function(){
            $('html, body').scrollTop(0).show();
            jump();
        }, 0);
    }else{
        $('html, body').show();
    }
});

 

// Smooth scroll dropdown menu // 
var windowWidth = $(window).width();
if(windowWidth > 800) {
    $(function() {
        $("a[href*='#'][href!='#']").click(function() {
            $('.nav-dropdown').hide();
            if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
                var target = $(this.hash);
                target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
                if (target.length) {
                    $('html,body').stop().animate({
                        scrollTop: target.offset().top
                    }, 800);
                    return false;
                }
            }
        });
    });
}

if(windowWidth < 800) {
    $(function() {
        $("a[href*='#'][href!='#']").click(function() {
            $('nav ul').slideToggle();
            $('#nav-toggle').removeClass('active');
            $('.nav-list').hide();
            if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
                var target = $(this.hash);
                target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
                if (target.length) {
                    $('html,body').stop().animate({
                        scrollTop: target.offset().top
                    }, 800);
                    return false;
                }
            }
        });
    });
}

